{% extends "home.html" %}

{% block title %}
Games
{% endblock %}

{% block content %}
{% load static %}

<h2>Game detail</h2>

<p> USERID: {{request.user.id}} {{request.user.username}} {{request.user.type}}</p>

<table>
    <tr>
        <td><b>Title:</b></td>
        <td>{{ this_game.name }}<br></td>
    </tr>
    <tr>
        <td><b>Description:</b></td>
        <td>{{ this_game.desc }}<br></td>
    </tr>
    <tr>
        <td><b>Creator:</b></td>
        <td>{{ this_game.creator }}<br></td>
    </tr>
    <tr>
        <td><b>Genre:</b></td>
        <td>{{ this_game.genre }}<br></td>
    </tr>
    <tr>
        <td><b>Age rating</b></td>
        <td>{{ this_game.age_rating }}<br></td>
    </tr>
    <tr>
        <td><b>Date created:</b></td>
        <td>{{ this_game.created_at }}<br></td>
    </tr>
    <tr>
        <td><b>Price:</b></td>
        <td>{{ this_game.price }}<br></td>
    </tr>   
    <tr>
        <td><b>Average Stars:</b></td>
        <td>{{ average_stars }}<br></td>
    </tr>
    <tr>
        <td><b>Image:</b></td>
        <td>
            {% if this_game.image %}
            <img src="{{ this_game.image.url }}" height="150" width="150">
            {% endif %}
        </td>
    </tr>
</table>

<div class="comment">
    {% for comment in all_comments %}
    <b style="color: darkgreen">{{ comment.myuser.username }} on {{ comment.timestamp }}</b>

    {% if not reported_already %}
        <button><a href="{% url 'comment-report' comment.id this_game.id %}"> REPORT THIS COMMENT </a></button>
    {% else %}
        <p>Thank you for reporting</p>
    {% endif %}

        {# WE SHOULD HAVE A METHOD THAT CHECKS THIS #}
        {% if comment.myuser == request.user and not request.user.is_superuser or not request.user.type == "CS" %}
            <button><a href="{% url 'comment-edit' comment.id %}"> EDIT MY COMMENT </a></button>
            <button><a href="{% url 'comment-delete' comment.id %}"> DELETE MY COMMENT </a></button>
        {% endif %}
        {# WE SHOULD HAVE A METHOD THAT CHECKS THIS #}
        {% if request.user.is_superuser or request.user.type == "CS" %}
            <button><a href="{% url 'comment-edit' comment.id %}"> EDIT THIS COMMENT </a></button>
            <button><a href="{% url 'comment-delete' comment.id %}"> DELETE THIS COMMENT </a></button>
        {% endif %}


    <div class="stars">
        {% for star in all_stars %}
        {% if star <= comment.star_rating %}
        {#  {{ forloop.counter }}  #}
        <img class="stars" src="{% static 'Games/star.png' %}" height="20" width="20" style="float: left;">
        {% endif %}
        {% endfor %}
    </div>
    <div class="comment_vote_wrapper">
        {{ comment.text }}
        <div class="voting">
            {% if comment.voted_already %}
            <span style="color: grey">{{ comment.get_upvotes_count }}</span>
            {%else%}
            <span style="color: darkgreen">{{  comment.get_upvotes_count  }}</span>
            <a href="{% url 'game-vote' this_game.id comment.id 'up' %}" style="text-decoration: none">
                <img src="{% static 'Games/arrow_up.png' %}" height="20" width="20">
            </a>
            &nbsp;&nbsp;&nbsp;
            <span style="color: crimson">{{comment.get_downvotes_count}}</span>
            <a href="{% url 'game-vote' this_game.id comment.id 'down' %}" style="text-decoration: none">
                <img src="{% static 'Games/arrow_down.png' %}" height="20" width="20">
                {% endif %}
            </a>
        </div>
        {% endfor %}
        <br>
    </div>

    {% if not commented_already %}
    <b style="color: crimson">Do you have a comment at for this game?</b><br>
    <form method="POST">
        {% csrf_token %}
        {{ comment_form.as_p }}
        <button type="submit" onclick="window.location.reload()">Add comment</button>
        {# onclick="location = self.location.href;" #}

    </form>
    {% endif %}


    <a class="btn btn-primary" href={% url "game-delete" this_game.id %}>Delete</a>

    <br>
    <a href="{% url 'game-list' %}">Back to all games</a>

    <p> WENN JEMAND DEINEN KOMMENTAR EDITIERT DARF DER JENIGE WIEDER AUF DAS GAME KOMMENTIEREN (also der dessen Kommi editiert wurde)</p>

    <a href="{% url 'game-detail-pdf' this_game.id %}">GET PDF</a>

    {% endblock %}